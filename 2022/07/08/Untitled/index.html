<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="IT技术类博客，主要是运维方向(Docker、DevOPS、Golang等)"><title> | 冒了个小小泡</title><link rel="stylesheet" type="text/css" href="/abitming.github.io/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/abitming.github.io/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/abitming.github.io/favicon.ico"><link rel="apple-touch-icon" href="/abitming.github.io/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/abitming.github.io/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">冒了个小小泡</h1><a id="logo" href="/abitming.github.io/.">冒了个小小泡</a><p class="description">小明的博客</p></div><div id="nav-menu"><a class="current" href="/abitming.github.io/."><i class="fa fa-home"> 首页</i></a><a href="/abitming.github.io/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/abitming.github.io/about/"><i class="fa fa-user"> 关于</i></a><a href="/abitming.github.io/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Jul 8, 2022</div><div class="post-content"><h1 id="Pinpoint指南"><a href="#Pinpoint指南" class="headerlink" title="Pinpoint指南"></a>Pinpoint指南</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>官方地址：<a href="https://pinpoint-apm.gitbook.io/pinpoint" target="_blank" rel="noopener">https://pinpoint-apm.gitbook.io/pinpoint</a></p>
<p>pinpoint整体由4部分组成：存储(Hbase)、收集处理(Collector)、可视化(Web)、采集(Agent)，各部分的数据交互如下：</p>
<p><img src="/abitming.github.io/2022/07/08/Untitled/pinpoint.png" alt="pinpoint"></p>
<p>注意：因为使用的Hbase的资源而Hbase又依赖Zookeeper服务，所以在部署的时候需要特别注意这块的高可用情况。</p>
<h2 id="容器部署-K8S"><a href="#容器部署-K8S" class="headerlink" title="容器部署(K8S)"></a>容器部署(K8S)</h2><p>pinpoint镜像地址：<a href="https://hub.docker.com/r/pinpointdocker" target="_blank" rel="noopener">https://hub.docker.com/r/pinpointdocker</a></p>
<p>在Docker Hub 上提供了上面提到四部分的独立镜像，如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 版本可自行选择</span></span><br><span class="line"><span class="number">1</span>. docker pull pinpointdocker/pinpoint-web:<span class="number">2.4</span>.<span class="number">0</span></span><br><span class="line"><span class="number">2</span>. docker pull pinpointdocker/pinpoint-collector:<span class="number">2.4</span>.<span class="number">0</span></span><br><span class="line"><span class="number">3</span>. docker pull pinpointdocker/pinpoint-hbase:<span class="number">2.4</span>.<span class="number">0</span></span><br><span class="line"><span class="number">4</span>. docker pull pinpointdocker/pinpoint-agent:<span class="number">2.4</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>官方提供了使用 docker-compose 的部署方式，因为发现pinpoint的官方镜像的Dockerfile在以2.1.0版本为界，前后还是存在一些差异的。所以本文适用于2.1.0之后的版本。另外本文会介绍的是在K8S上的部署(抽时间我再去踩一踩docker-compose部署的坑)。部署顺序建议如下：Hbase -&gt; Collector -&gt; Web -&gt; Agent</p>
<h4 id="pinpoint-hbase"><a href="#pinpoint-hbase" class="headerlink" title="pinpoint-hbase"></a>pinpoint-hbase</h4><p>使用pinpoint-hbase这个镜像时，需要特别数据挂载路径和是否使用内置Zookeeper的问题。</p>
<ol>
<li><p>数据目录挂载问题</p>
<p>在pinpoint-hbase的Dockerfile中，出现以下挂载动作。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span> [/home/pinpoint/hbase /home/pinpoint/zookeeper]</span><br></pre></td></tr></table></figure>
<p>所以在使用K8S部署时，一定要设置这两个目录的挂载点。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span> ["/bin/sh" "-c" "/usr/local/bin/initialize-hbase.sh &amp;&amp; tail -f /dev/null"]</span><br></pre></td></tr></table></figure>
<p>通过查看Docker的启动命令发现，在 initialize-hbase.sh 脚本中直接调用  start-hbase.sh脚本，在 start-hbase.sh 脚本中出现了如下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$distMode</span>"</span> == <span class="string">'false'</span> ]</span><br><span class="line">then</span><br><span class="line">  <span class="string">"<span class="variable">$bin</span>"</span>/hbase-daemon.sh --config <span class="string">"$&#123;HBASE_CONF_DIR&#125;"</span> <span class="variable">$commandToRun</span> master $@</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="string">"<span class="variable">$bin</span>"</span>/hbase-daemons.sh --config <span class="string">"$&#123;HBASE_CONF_DIR&#125;"</span> <span class="variable">$commandToRun</span> zookeeper</span><br><span class="line">  <span class="string">"<span class="variable">$bin</span>"</span>/hbase-daemon.sh --config <span class="string">"$&#123;HBASE_CONF_DIR&#125;"</span> <span class="variable">$commandToRun</span> master</span><br><span class="line">  <span class="string">"<span class="variable">$bin</span>"</span>/hbase-daemons.sh --config <span class="string">"$&#123;HBASE_CONF_DIR&#125;"</span> \</span><br><span class="line">    --hosts <span class="string">"$&#123;HBASE_REGIONSERVERS&#125;"</span> <span class="variable">$commandToRun</span> regionserver</span><br><span class="line">  <span class="string">"<span class="variable">$bin</span>"</span>/hbase-daemons.sh --config <span class="string">"$&#123;HBASE_CONF_DIR&#125;"</span> \</span><br><span class="line">    --hosts <span class="string">"$&#123;HBASE_BACKUP_MASTERS&#125;"</span> <span class="variable">$commandToRun</span> master-backup</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>HBASE_CONF_DIR 中放置了启动时需要的参数，如果需要对参数进行修改，则需要使用ConfigMap 将 /opt/hbase/hbase-1.2.6/conf 这个路径挂载到容器内修改 hbase-site.xml 文件。</p>
</li>
</ol>
<ol start="2">
<li><p>Zookeeper相关问题</p>
<p>在使用默认文件启动时会遇到以下报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">05</span>:<span class="number">58</span>:<span class="number">51</span>,<span class="number">688</span> WARN  [main] util.NativeCodeLoader: Unable to load <span class="keyword">native</span>-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line"><span class="number">2022</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">05</span>:<span class="number">59</span>:<span class="number">06</span>,<span class="number">957</span> ERROR [main] zookeeper.RecoverableZooKeeper: ZooKeeper exists failed after <span class="number">4</span> attempts</span><br><span class="line"><span class="number">2022</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">05</span>:<span class="number">59</span>:<span class="number">06</span>,<span class="number">958</span> WARN  [main] zookeeper.ZKUtil: hconnection-<span class="number">0x7636823f0</span>x0, quorum=zoo1:<span class="number">2181</span>,zoo2:<span class="number">2181</span>,zoo3:<span class="number">2181</span>, baseZNode=/<span class="function">hbase Unable to set watcher on <span class="title">znode</span> <span class="params">(/hbase/hbaseid)</span></span></span><br><span class="line"><span class="function">org.apache.zookeeper.KeeperException$OperationTimeoutException: KeeperErrorCode </span>= OperationTimeout</span><br><span class="line">	at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.checkZk(RecoverableZooKeeper.java:<span class="number">144</span>)</span><br><span class="line">	at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.exists(RecoverableZooKeeper.java:<span class="number">220</span>)</span><br></pre></td></tr></table></figure>
<p>以上报错的原因是pinpoint-hbase服务部署时默认不使用内置Zookeeper，而hbase-site.xml默认配置文件中包含了以下配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>zoo1,zoo2,zoo3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果你不想使用内置的ZK，那么只需要把这个地方配置为你的目标ZK地址就行了。</li>
<li>如果你需要使用内置ZK，你需要操作两步：<ol>
<li>将参数 HBASE_MANAGES_ZK 修改为 true (默认false为使用外置ZK)</li>
<li>删除hbase-site.xml中上面提到的zoo1,zoo2,zoo3的配置</li>
<li>变量 PINPOINT_HBASE_NAME 为 pinpoint-hbase (这个是ServiceName，具体可以根据你的部署情况有变化，保证这个地址指向的是ZK就行)</li>
</ol>
</li>
</ul>
<p>服务启动成功之后，会启动5个端口，分别为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Zookeeper: 2181</span><br><span class="line">API: 60000</span><br><span class="line">Hbase Web UI : 16010</span><br><span class="line">Region Server API : 60020</span><br><span class="line">Region Server Web UI : 16030</span><br></pre></td></tr></table></figure>
<p>检验是否安装成功可直接访问 Hbase Web UI，正常在 Tables -&gt; User Tables 下会创建 15 张表则表示Hbase安装成功了。</p>
<h4 id="pinpoint-collector"><a href="#pinpoint-collector" class="headerlink" title="pinpoint-collector"></a>pinpoint-collector</h4><p>在Hbase部署完成之后，要开始进行其他组件的部署。原则上我们可以部署一个单独的Pod(和Hbase不在同一个Pod上)。</p>
<h5 id="问题1"><a href="#问题1" class="headerlink" title="问题1."></a>问题1.</h5><p>在服务启动时出现如下报错：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">07-07 01:28:03.003 [main] INFO  o.a.h.h.s.o.a.z.ZooKeeper: Initiating client connection, connectString=&#123;YOUR_RELEASE_ZOOKEEPER_ADDRESS&#125;:2181 sessionTimeout=90000 watcher=org.apache.hadoop.hbase.zookeeper.PendingWatcher@632aa1a3</span><br><span class="line">07-07 01:28:03.003 [main] WARN  o.a.h.h.z.RecoverableZooKeeper: Unable to create ZooKeeper Connection</span><br><span class="line">java.net.UnknownHostException: &#123;YOUR_RELEASE_ZOOKEEPER_ADDRESS&#125;</span><br><span class="line">	at java.net.InetAddress$CachedAddresses.get(InetAddress.java:797) ~[?:?]</span><br><span class="line">	at java.net.InetAddress.getAllByName0(InetAddress.java:1509) ~[?:?]</span><br><span class="line">	at java.net.InetAddress.getAllByName(InetAddress.java:1368) ~[?:?]</span><br><span class="line">	at java.net.InetAddress.getAllByName(InetAddress.java:1302) ~[?:?]</span><br><span class="line">	at org.apache.hadoop.hbase.shaded.org.apache.zookeeper.client.StaticHostProvider.&lt;init&gt;(StaticHostProvider.java:61) ~[hbase-shaded-client-1.7.1.jar!/:1.7.1]</span><br><span class="line">	at org.apache.hadoop.hbase.shaded.org.apache.zookeeper.ZooKeeper.&lt;init&gt;(ZooKeeper.java:445)</span><br></pre></td></tr></table></figure>
<p>报错原因为： collector 没有找到 Zookeeper 的地址，需要在容器启动时将 Zookeeper的地址传入容器中：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">PINPOINT_ZOOKEEPER_ADDRESS</span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">pinpoint-hbase</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="问题2"><a href="#问题2" class="headerlink" title="问题2."></a>问题2.</h5><p>   想要修改配置文件，可以进行ConfigMap的挂载，但是可能会出现如下报错：</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">07</span>-<span class="number">07</span> <span class="number">01</span>:<span class="number">56</span>:<span class="number">23.409</span> ERROR CollectorApp: [CollectorApp] could not launch app.</span><br><span class="line">org.springframework.boot.context.config.ConfigDataResourceNotFoundException: Config data resource <span class="string">'file [/pinpoint/config/pinpoint-collector.properties]'</span> via location <span class="string">'/pinpoint/config/pinpoint-collector.properties'</span> cannot be found</span><br><span class="line">	at org.springframework.boot.context.config.ConfigDataResourceNotFoundException.withLocation(ConfigDataResourceNotFoundException.java:<span class="number">97</span>)</span><br></pre></td></tr></table></figure>
<p>   问题的原因：挂载的文件权限默认为420，但是这个配置文件需要有执行权限需要644。这个地方可以通过修改deployment的yaml文件解决，当前我们用的腾讯云的管理平台并不支持修改这个地方的权限，那就只能把配置文件中的参数变成变量的形式传到容器中，参考问题1。</p>
<h5 id="问题3"><a href="#问题3" class="headerlink" title="问题3."></a>问题3.</h5><p>   如果使用了内置ZK并且Collector部署在另外一个Pod上在ZK地址设置正确的情况下，可能还会遇到如下报错：</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9</span>:<span class="number">51</span>:<span class="number">53.245</span> [main] INFO  org.apache.zookeeper.ZooKeeper - Initiating client connection, connectString=pinpoint-hbase-<span class="number">0</span>:<span class="number">2181</span> sessionTimeout=<span class="number">60000</span> watcher=org.apache.curator.ConnectionState@<span class="number">310</span>d05c5</span><br><span class="line"><span class="number">19</span>:<span class="number">51</span>:<span class="number">58.334</span> [main] ERROR org.apache.curator.ConnectionState - <span class="function">Connection timed out <span class="keyword">for</span> connection <span class="title">string</span> <span class="params">(pinpoint-hbase<span class="number">-0</span>:<span class="number">2181</span>)</span> and <span class="title">timeout</span> <span class="params">(<span class="number">5000</span>)</span> / <span class="title">elapsed</span> <span class="params">(<span class="number">5104</span>)</span></span></span><br><span class="line"><span class="function">org.apache.curator.CuratorConnectionLossException: KeeperErrorCode </span>= ConnectionLoss</span><br><span class="line">	at org.apache.curator.ConnectionState.checkTimeouts(ConnectionState.java:<span class="number">225</span>) [curator-client-<span class="number">2.13</span>.0.jar:?]</span><br><span class="line">	at org.apache.curator.ConnectionState.getZooKeeper(ConnectionState.java:<span class="number">94</span>) [curator-client-<span class="number">2.13</span>.0.jar:?]</span><br></pre></td></tr></table></figure>
<p>   问题的原因：由于ZK的地址为Pod的ServiceName：pinpoint-hbase，但是ZK是注册实例的是为主机地址(我只启动了一个实例，实例名为：pinpoint-hbase-0)，Collector在调用ZK时，获取到的就是这个实例的地址，但是在另外一个Pod中这个实例的地址是不可访问的。一种解决办法就是修改在Collector的host文件，通过地址绑定让实例地址可被解析，但由于K8S部署本身使用的网络模式会重写host文件，导致这个可能会随时失效。最好的办法就是将Collector和Hbase不是在一个Pod中，因为共用实例名，自然就能访问了。这个问题如果是Zookeeper在集群外，那就直接修改Collector配置就行了，但是如果遇到问题2，那就没办法了。</p>
<h4 id="pinpoint-web"><a href="#pinpoint-web" class="headerlink" title="pinpoint-web"></a>pinpoint-web</h4><p>   Web作为Pinpoint的可视化模块，原理上只需要和Collector做数据交互就可以了。</p>
<h5 id="问题4"><a href="#问题4" class="headerlink" title="问题4."></a>问题4.</h5><p>   Web在启动时需要设置链接Collector的地址，使用 HBASE_CLIENT_HOST 变量，但是启动时依然会出现以下报错：</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error starting ApplicationContext. To display the conditions report re-run your application with <span class="string">'debug'</span> enabled.</span><br><span class="line"><span class="number">07</span>-<span class="number">07</span> <span class="number">07</span>:<span class="number">09</span>:<span class="number">53.053</span> [main] ERROR o.s.b.SpringApplication -- Application run failed</span><br><span class="line">org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'agentServiceImpl' defined in URL [jar:file:/pinpoint/pinpoint-web-boot.jar!/BOOT-INF/classes!/com/navercorp/pinpoint/web/service/AgentServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'clusterManager' defined in class path resource [applicationContext-web.xml]: Cannot resolve reference to bean 'webConfig' while setting constructor argument; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'webConfig': Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: clusterZookeeperAddress may not be empty =</span><br><span class="line">	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:<span class="number">800</span>) ~[spring-beans-<span class="number">5.3</span>.20.jar!/:<span class="number">5.3</span>.20]</span><br></pre></td></tr></table></figure>
<p>   问题原因：Pinpoint-web除了需要设置Collector的地址之外，由于其还需要和ZK进行链接(这块有点奇怪，没有仔细研究，原理上Web应该不需要和ZK链接)，需要增加ZK的地址。</p>
   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">HBASE_CLIENT_HOST</span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">CLUSTER_ZOOKEEPER_ADDRESS</span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">pinpoint-hbase</span></span><br></pre></td></tr></table></figure>
<p>   特别需要注意是是变量名和之前的几个组件不一样。</p>
<h4 id="pinpoint-agent"><a href="#pinpoint-agent" class="headerlink" title="pinpoint-agent"></a>pinpoint-agent</h4><p>   agent可以直接已参数的形式追加在 Java 服务的启动项后面，但是必须包含以下这三个参数：</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -Dpinpoint.agentId=&#123;Hostname&#125; 全局唯一</span></span><br><span class="line">-Dpinpoint.agentId=<span class="number">172.16</span>.0.250 </span><br><span class="line"><span class="comment">// -Dpinpoint.applicationName=&#123;Appname&#125; 一般按照项目或者服务维度标识(即监控的最小单元)</span></span><br><span class="line">-Dpinpoint.applicationName=sms-center </span><br><span class="line"><span class="comment">// -javaagent:/opt/pinpoint/pinpoint-bootstrap-2.0.4.jar agent-jar包路径</span></span><br><span class="line">-javaagent:/opt/pinpoint/pinpoint-bootstrap-<span class="number">2.0</span>.4.jar</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 参考启动方式</span></span><br><span class="line">java -jar -Dfile.encoding=utf-<span class="number">8</span> -Xms512m -Xmx512m -Dpinpoint.agentId=<span class="number">172.16</span>.0.250 -Dpinpoint.applicationName=sms-center -javaagent:/opt/pinpoint/pinpoint-bootstrap-<span class="number">2.0</span>.4.jar /opt/sms-center.jar</span><br></pre></td></tr></table></figure>
<h4 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h4><p>   <strong>1.Pinpoint效果图</strong></p>
<p>   <img src="/abitming.github.io/2022/07/08/Untitled/image-20220711091542629.png" alt="image-20220711091542629"></p>
<p>   <strong>2.yaml文件</strong></p>
   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1beta2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  creationTimestamp:</span> <span class="string">"2022-07-06T05:57:11Z"</span></span><br><span class="line"><span class="attr">  generation:</span> <span class="number">16</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">hkr</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"7487273148"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/apis/apps/v1beta2/namespaces/hkr/statefulsets/pinpoint-hbase</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="number">917</span><span class="string">d1825-27a6-47af-93fb-5d34bfbebd6a</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  podManagementPolicy:</span> <span class="string">OrderedReady</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">      qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">""</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      annotations:</span></span><br><span class="line"><span class="attr">        qcloud-redeploy-timestamp:</span> <span class="string">"1657177105996"</span></span><br><span class="line"><span class="attr">      creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">PINPOINT_HBASE_NAME</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">HBASE_MANAGES_ZK</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">HBASE_ZOOKEEPER_QUORUM</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">pinpoint-hbase-0</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">pinpointdocker/pinpoint-hbase:2.4.0</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">        terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line"><span class="attr">        terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - mountPath:</span> <span class="string">/home/pinpoint/hbase</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">data</span></span><br><span class="line"><span class="attr">          subPath:</span> <span class="string">hbase</span></span><br><span class="line"><span class="attr">        - mountPath:</span> <span class="string">/home/pinpoint/zookeeper</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">data</span></span><br><span class="line"><span class="attr">          subPath:</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">        - mountPath:</span> <span class="string">/opt/hbase/hbase-1.2.6/conf</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">hbase-site</span></span><br><span class="line"><span class="attr">          subPath:</span> <span class="string">conf</span></span><br><span class="line"><span class="attr">      - env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">PINPOINT_ZOOKEEPER_ADDRESS</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">pinpointdocker/pinpoint-collector:2.4.0</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">pinpoint-collector</span></span><br><span class="line"><span class="attr">        resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">        terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line"><span class="attr">        terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line"><span class="attr">      - env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">CLUSTER_ZOOKEEPER_ADDRESS</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">HBASE_CLIENT_HOST</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">pinpointdocker/pinpoint-web:2.4.0</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">pinpoint-web</span></span><br><span class="line"><span class="attr">        resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">        terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line"><span class="attr">        terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line"><span class="attr">      dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">      schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line"><span class="attr">      securityContext:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">      terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - emptyDir:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">data</span></span><br><span class="line"><span class="attr">      - configMap:</span></span><br><span class="line"><span class="attr">          defaultMode:</span> <span class="number">420</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">hbase-site</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">hbase-site</span></span><br><span class="line"><span class="attr">  updateStrategy:</span></span><br><span class="line"><span class="attr">    rollingUpdate:</span></span><br><span class="line"><span class="attr">      partition:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">RollingUpdate</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  collisionCount:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">  currentReplicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  currentRevision:</span> <span class="string">pinpoint-hbase-6c77f66856</span></span><br><span class="line"><span class="attr">  observedGeneration:</span> <span class="number">16</span></span><br><span class="line"><span class="attr">  readyReplicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  updateRevision:</span> <span class="string">pinpoint-hbase-6c77f66856</span></span><br><span class="line"><span class="attr">  updatedReplicas:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Service -- pinpoint-hbase</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  creationTimestamp:</span> <span class="string">"2022-07-06T05:57:11Z"</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">hkr</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"7437604834"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/api/v1/namespaces/hkr/services/pinpoint-hbase</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="string">a391d3a9-41e0-4800-85b6-17fa28e61756</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  clusterIP:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.162</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">2181</span><span class="bullet">-2181</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">2181</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">2181</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">60000</span><span class="bullet">-60000</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">16010</span><span class="bullet">-16010</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">16010</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">16010</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">60020</span><span class="bullet">-60020</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">60020</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">60020</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">16030</span><span class="bullet">-16030</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">16030</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">16030</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  sessionAffinity:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  loadBalancer:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Service -- pinpoint-collector</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  creationTimestamp:</span> <span class="string">"2022-07-07T06:30:58Z"</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pinpoint-collector</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">hkr</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"7485421962"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/api/v1/namespaces/hkr/services/pinpoint-collector</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="string">bf8bb7ce-e387-4a05-8df6-d38e42b9e177</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  clusterIP:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.111</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9991</span><span class="bullet">-9991</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9991</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9991</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9992</span><span class="bullet">-9992</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9992</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9992</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9993</span><span class="bullet">-9993</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9993</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9993</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9994</span><span class="bullet">-9994</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9994</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9994</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9995</span><span class="bullet">-9995</span><span class="bullet">-udp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9995</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">UDP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9995</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9996</span><span class="bullet">-9996</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9996</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9996</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  sessionAffinity:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  loadBalancer:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Service -- pinpoint-web</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">service.cloud.tencent.com/direct-access:</span> <span class="string">"false"</span></span><br><span class="line">    <span class="string">service.kubernetes.io/service.extensiveParameters:</span> <span class="string">"null"</span></span><br><span class="line"><span class="attr">  creationTimestamp:</span> <span class="string">"2022-07-07T07:32:42Z"</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pinpoint-web</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">hkr</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"7521216267"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/api/v1/namespaces/hkr/services/pinpoint-web</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="number">20</span><span class="string">b26ef4-c3ec-407e-9063-d9171180a6b4</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  clusterIP:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.179</span></span><br><span class="line"><span class="attr">  externalTrafficPolicy:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">8080</span><span class="bullet">-8080</span><span class="bullet">-tcp</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">31444</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="number">9997</span><span class="bullet">-9997</span><span class="bullet">-tcp-coe4u7apbxc</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">31333</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9997</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">9997</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">    qcloud-app:</span> <span class="string">pinpoint-hbase</span></span><br><span class="line"><span class="attr">  sessionAffinity:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  loadBalancer:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Docker-Compose部署"><a href="#Docker-Compose部署" class="headerlink" title="Docker-Compose部署"></a>Docker-Compose部署</h2></div><div class="tags"></div><div class="post-nav"><a class="next" href="/abitming.github.io/2020/04/23/Sina/">Sina，江湖再见</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/abitming.github.io/tags/Linux，Docker/" style="font-size: 15px;">Linux，Docker</a> <a href="/abitming.github.io/tags/CNCF，Prometheus，Thanos，AlterManager/" style="font-size: 15px;">CNCF，Prometheus，Thanos，AlterManager</a> <a href="/abitming.github.io/tags/SRE、运维/" style="font-size: 15px;">SRE、运维</a> <a href="/abitming.github.io/tags/Ceph，存储/" style="font-size: 15px;">Ceph，存储</a> <a href="/abitming.github.io/tags/感想/" style="font-size: 15px;">感想</a> <a href="/abitming.github.io/tags/Varnish，Cache/" style="font-size: 15px;">Varnish，Cache</a> <a href="/abitming.github.io/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/abitming.github.io/tags/自述/" style="font-size: 15px;">自述</a> <a href="/abitming.github.io/tags/Golang/" style="font-size: 15px;">Golang</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2022/07/08/Untitled/">Untitled</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2020/04/23/Sina/">Sina，江湖再见</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2020/04/16/SRE/">SRE 运维解密</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2020/04/16/Prometheus/">基于Prometheus的监控平台</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2020/04/09/Ceph那些事/">Ceph初探</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2020/04/09/varnish那些事/">Varnish缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2019/12/31/容器技术 - Docker网络/">容器技术 - Docker网络</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2019/12/23/容器技术 - Dockerfile/">容器技术 - Dockerfile</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2019/08/16/Linux的limit以及Docker的中的应用/">Linux的limit.conf以及在Docker中的应用</a></li><li class="post-list-item"><a class="post-list-link" href="/abitming.github.io/2019/05/05/白话golang并发/">白话Golang并发</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.docker.com" title="Docker官网" target="_blank">Docker官网</a><ul></ul><a href="https://kubernetes.io" title="Kubernetes官网" target="_blank">Kubernetes官网</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/abitming.github.io/." rel="nofollow">冒了个小小泡.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Abitming.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/abitming.github.io/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/abitming.github.io/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/abitming.github.io/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/abitming.github.io/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/abitming.github.io/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/abitming.github.io/js/smartresize.js?v=0.0.0"></script></div></body></html>